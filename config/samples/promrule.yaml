apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: prometheus-example-rules
  labels:
    app.kubernetes.io/name: openawareness-controller
    prometheus: example
    role: alert-rules
  annotations:
    # Reference to the ClientConfig that provides Mimir connection details
    openawareness.io/client-name: "clientconfig-sample"
    # Mimir namespace/tenant for these rules
    openawareness.io/mimir-tenant: "default-tenant"
spec:
  groups:
    - name: example.rules
      interval: 30s
      rules:
        # Alert rule example
        - alert: InstanceDown
          expr: up == 0
          for: 5m
          labels:
            severity: critical
            team: platform
          annotations:
            summary: "Instance {{ $labels.instance }} is down"
            description: |
              Instance {{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.
            runbook_url: "https://wiki.example.org/runbooks/instance-down"
        
        # Warning alert example
        - alert: HighErrorRate
          expr: |
            (
              rate(http_requests_total{status=~"5.."}[5m])
              /
              rate(http_requests_total[5m])
            ) > 0.05
          for: 10m
          labels:
            severity: warning
            team: platform
          annotations:
            summary: "High error rate detected"
            description: |
              Error rate is {{ $value | humanizePercentage }} over the last 5 minutes.
              More than 5% of requests are failing.
        
        # Recording rule example
        - record: instance:up:ratio
          expr: avg_over_time(up[5m])
          labels:
            team: platform
